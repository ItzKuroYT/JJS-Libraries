<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>JJS Library — Search & Copy</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa4b2;--accent:#7c3aed;--glass:rgba(255,255,255,0.03)}
    html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#071024 0%,#081226 100%);color:#e6eef6}
    .container{max-width:980px;margin:36px auto;padding:28px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:12px;box-shadow:0 6px 30px rgba(2,6,23,0.8)}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between}
    h1{font-size:20px;margin:0}
    .credits{font-size:13px;color:var(--muted)}
    .controls{display:flex;gap:12px;align-items:center;margin-top:14px}
    input.search{flex:1;padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:inherit}
    .list{margin-top:18px;display:grid;gap:12px}
    .card{background:var(--card);padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,0.02)}
    .card h3{margin:0;font-size:16px}
    .meta{font-size:13px;color:var(--muted);margin-top:6px;display:flex;gap:8px;align-items:center}
    .actions{margin-top:10px;display:flex;gap:8px}
    button{background:linear-gradient(180deg,var(--accent),#5b21b6);border:none;color:white;padding:8px 10px;border-radius:8px;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    pre.code{background:#020617;color:#dff0ff;padding:12px;border-radius:8px;overflow:auto;max-height:260px;margin:10px 0}
    .small{font-size:13px}
    .link{color:var(--accent);text-decoration:none}
    @media(max-width:600px){.container{margin:18px;padding:16px}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>JJS Library — Search & Copy</h1>
        <div class="credits">Original credits shown in each library. Use code sections to view or copy.</div>
      </div>
      <div class="small">Made for Jujutsu Shenanigans</div>
    </header>

    <div class="controls">
      <input id="search" class="search" placeholder="Search libraries (title, tags)..." />
      <button id="createEntry" class="ghost">Create</button>
      <button id="newEntry" class="ghost">+ Add</button>
    </div>

    <div id="list" class="list"></div>
  </div>

  <template id="cardTpl">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <h3 class="title"></h3>
          <div class="meta"><span class="author"></span><span class="sep">•</span><a class="orig link" target="_blank">Original credit</a></div>
        </div>
        <div class="small">tag: <span class="tags"></span></div>
      </div>
      <div class="actions">
        <button class="toggle">Show code</button>
        <button class="copy">Copy</button>
        <button class="ghost viewOrig">Open credit</button>
      </div>
      <div class="codeWrap" style="display:none">
        <pre class="code" data-full=""></pre>
      </div>
    </div>
  </template>

  <script>

    const libs = [
      {
        id: 'hollow-purple',
        title: 'Hollow Purple 200% + Imaginary',
        author: '@dino0909',
        credit: 'https://www.youtube.com/@dino0909',
        tags: ['hollow','purple','damage','imaginary'],
        code: `code`
      }
    ];

    const listEl = document.getElementById('list');
    const tpl = document.getElementById('cardTpl');
    const search = document.getElementById('search');

    function render(filtered){
      listEl.innerHTML = '';
      if(filtered.length===0){
        listEl.innerHTML = '<div class="small">No libraries match your search.</div>';
        return;
      }
      filtered.forEach(lib=>{
        const node = tpl.content.cloneNode(true);
        node.querySelector('.title').textContent = lib.title;
        node.querySelector('.author').textContent = lib.author;
        node.querySelector('.orig').href = lib.credit;
        node.querySelector('.orig').textContent = 'Credit';
        node.querySelector('.tags').textContent = lib.tags.join(', ');
        const pre = node.querySelector('.code');
        pre.textContent = lib.code;
        pre.setAttribute('data-full', lib.code);

        const toggle = node.querySelector('.toggle');
        const copyBtn = node.querySelector('.copy');
        const viewOrig = node.querySelector('.viewOrig');
        const wrap = node.querySelector('.codeWrap');

        toggle.addEventListener('click', ()=>{
          if(wrap.style.display==='none'){
            wrap.style.display='block'; toggle.textContent='Hide code';
          } else { wrap.style.display='none'; toggle.textContent='Show code'; }
        });

        copyBtn.addEventListener('click', async ()=>{
          await navigator.clipboard.writeText(pre.getAttribute('data-full'));
          copyBtn.textContent='Copied!';
          setTimeout(()=>copyBtn.textContent='Copy',1400);
        });

        viewOrig.addEventListener('click', ()=>window.open(lib.credit,'_blank'));

        listEl.appendChild(node);
      });
    }

    function filter(q){
      q = q.trim().toLowerCase();
      if(!q) return libs.slice();
      return libs.filter(l=>{
        return l.title.toLowerCase().includes(q) || 
               (l.tags||[]).some(t=>t.includes(q)) || 
               l.author.toLowerCase().includes(q);
      });
    }

    search.addEventListener('input', ()=>{
      render(filter(search.value));
    });

    document.getElementById('newEntry').addEventListener('click', ()=>{
      window.open('https://discord.gg/h9bxQMPUMY', '_blank');
    });

    /* ===========================
       GitHub Auto-Save (FORCED)
    ============================ */

    const GITHUB = {
      owner: 'YOUR_USERNAME',
      repo: 'YOUR_REPO',
      path: 'libs',
      branch: 'auto-save',
      token: 'YOUR_GITHUB_PAT'
    };

    const bannedWords = [
      "fuck","shit","bitch","asshole","nigger","nigga",
      "faggot","retard","cunt","slut","whore","rape","rapist"
    ];

    function containsBannedWord(text){
      if(!text) return false;
      const lower = text.toLowerCase();
      return bannedWords.some(word =>
        new RegExp(`\\b${word}\\b`, 'i').test(lower)
      );
    }

    document.getElementById('createEntry').addEventListener('click', async ()=>{

      const title = prompt('Title for library:','New Library');
      if(!title) return;

      const credit = prompt('Credit link (optional):','');
      const code = prompt('Paste code:','-- code');

      if(
        containsBannedWord(title) ||
        containsBannedWord(credit) ||
        containsBannedWord(code)
      ){
        alert("Inappropriate language detected. Entry blocked.");
        return;
      }

      const lib = {
        id: Date.now().toString(),
        title,
        author: 'You',
        credit,
        code,
        tags: []
      };

      libs.push(lib);
      render(filter(search.value));

      const filename = `${lib.id}-${sanitizeFilename(lib.title)}.json`;

      try{
        await saveToGitHub(lib, filename);
        alert('Saved permanently to branch: ' + GITHUB.branch);
      }catch(err){
        console.error(err);
        alert('GitHub save failed.');
      }
    });

    function sanitizeFilename(name){
      return name.replace(/[^a-z0-9-_. ]/gi,'_').slice(0,60);
    }

    async function saveToGitHub(obj, filename){

      const basePath = GITHUB.path ? GITHUB.path.replace(/^\/+|\/+$/g,'') + '/' : '';
      const path = `${basePath}${filename}`;

      const apiBase = `https://api.github.com/repos/${GITHUB.owner}/${GITHUB.repo}/contents/${encodeURIComponent(path)}`;

      const headers = {
        'Accept': 'application/vnd.github+json',
        'Authorization': `Bearer ${GITHUB.token}`,
        'Content-Type': 'application/json'
      };

      let sha = null;

      const check = await fetch(`${apiBase}?ref=${GITHUB.branch}`, { headers });

      if(check.ok){
        const existing = await check.json();
        sha = existing.sha;
      }

      const content = btoa(unescape(encodeURIComponent(JSON.stringify(obj, null, 2))));

      const body = {
        message: `Auto-save: ${obj.title}`,
        content: content,
        branch: GITHUB.branch,
        sha: sha || undefined
      };

      const response = await fetch(apiBase, {
        method: 'PUT',
        headers,
        body: JSON.stringify(body)
      });

      if(!response.ok){
        throw new Error(await response.text());
      }

      return await response.json();
    }

    render(libs);

  </script>
</body>
</html>

