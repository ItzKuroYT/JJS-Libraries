name: Save Library via repository_dispatch

on:
  repository_dispatch:
    types: [save-lib]

permissions:
  contents: write

jobs:
  save-lib:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Create or update file from payload
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const fs = require('fs');
            const path = `${{ github.event.client_payload.path }}`;
            const content = ${{ toJson(github.event.client_payload.content) }};
            fs.mkdirSync(require('path').dirname(path), { recursive: true });
            fs.writeFileSync(path, content);
            await exec('git', ['config', '--global', 'user.name', 'github-actions']);
            await exec('git', ['config', '--global', 'user.email', 'github-actions@github.com']);
            await exec('git', ['add', path]);
            await exec('git', ['commit', '-m', `Add/Update library ${{ github.event.client_payload.filename }}`]);
            await exec('git', ['push']);
